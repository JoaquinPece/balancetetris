<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Balance - Contabilidad Interactiva</title>
    
    <meta name="description" content="Juego tipo Tetris para aprender contabilidad. Clasifica elementos del balance mientras caen.">
    <meta name="keywords" content="tetris, contabilidad, balance, juego educativo">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .game-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .falling-element {
            animation: fall 0.1s linear;
        }
        @keyframes fall {
            from { transform: translateY(-20px); }
            to { transform: translateY(0px); }
        }
        .glow {
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .category-slot {
            min-height: 100px;
            border: 3px dashed transparent;
            transition: all 0.3s ease;
        }
        .category-slot.active {
            border-color: #fbbf24;
            background-color: rgba(251, 191, 36, 0.1);
        }
        .category-slot.correct {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.2);
            animation: correctPulse 0.6s;
        }
        .category-slot.incorrect {
            border-color: #ef4444;
            background-color: rgba(239, 68, 68, 0.2);
            animation: shake 0.5s;
        }
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .game-board {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = window.React;

// ICONOS
const Play = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const Pause = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const RotateCcw = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" /></svg>;
const Trophy = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v5l-3-1 3-1 3 1-3 1zm0 0l-.5-3H12l-.5 3z" /></svg>;
const Zap = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>;

// ELEMENTOS DEL BALANCE
const balanceElements = [
    { name: 'Existencias', category: 'activo-corriente', color: 'bg-green-400', icon: '📦' },
    { name: 'Clientes', category: 'activo-corriente', color: 'bg-green-400', icon: '👥' },
    { name: 'Proveedores', category: 'pasivo-corriente', color: 'bg-red-400', icon: '🏪' },
    { name: 'Capital Social', category: 'fondos-propios', color: 'bg-purple-400', icon: '💰' },
    { name: 'Reservas', category: 'fondos-propios', color: 'bg-purple-400', icon: '🏦' },
    { name: 'Inmovilizado', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '🏢' },
    { name: 'Bancos', category: 'activo-corriente', color: 'bg-green-400', icon: '🏛️' },
    { name: 'Caja', category: 'activo-corriente', color: 'bg-green-400', icon: '💵' },
    { name: 'Préstamos L/P', category: 'pasivo-no-corriente', color: 'bg-orange-400', icon: '📋' },
    { name: 'Préstamos C/P', category: 'pasivo-corriente', color: 'bg-red-400', icon: '📄' },
    { name: 'Acreedores', category: 'pasivo-corriente', color: 'bg-red-400', icon: '💳' },
    { name: 'IVA Soportado', category: 'activo-corriente', color: 'bg-green-400', icon: '📊' },
    { name: 'IVA Repercutido', category: 'pasivo-corriente', color: 'bg-red-400', icon: '📈' },
    { name: 'Maquinaria', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '⚙️' },
    { name: 'Resultado', category: 'fondos-propios', color: 'bg-purple-400', icon: '📊' },
    { name: 'Terrenos', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '🏞️' },
    { name: 'Construcciones', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '🏗️' },
    { name: 'Mobiliario', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '🪑' },
    { name: 'Deudores', category: 'activo-corriente', color: 'bg-green-400', icon: '👤' },
    { name: 'H.P. Deudora', category: 'activo-corriente', color: 'bg-green-400', icon: '🏛️' },
    { name: 'H.P. Acreedora', category: 'pasivo-corriente', color: 'bg-red-400', icon: '🏛️' },
    { name: 'Anticipos Clientes', category: 'pasivo-corriente', color: 'bg-red-400', icon: '💸' },
    { name: 'Equipos Informáticos', category: 'activo-no-corriente', color: 'bg-blue-400', icon: '💻' },
    { name: 'Efectos a Cobrar', category: 'activo-corriente', color: 'bg-green-400', icon: '📋' },
    { name: 'Efectos a Pagar', category: 'pasivo-corriente', color: 'bg-red-400', icon: '📋' }
];

// CATEGORÍAS
const categories = {
    'activo-corriente': { name: 'Activo Corriente', color: 'bg-green-100 border-green-400', textColor: 'text-green-800' },
    'activo-no-corriente': { name: 'Activo No Corriente', color: 'bg-blue-100 border-blue-400', textColor: 'text-blue-800' },
    'pasivo-corriente': { name: 'Pasivo Corriente', color: 'bg-red-100 border-red-400', textColor: 'text-red-800' },
    'pasivo-no-corriente': { name: 'Pasivo No Corriente', color: 'bg-orange-100 border-orange-400', textColor: 'text-orange-800' },
    'fondos-propios': { name: 'Fondos Propios', color: 'bg-purple-100 border-purple-400', textColor: 'text-purple-800' }
};

// COMPONENTE PRINCIPAL
const TetrisBalanceGame = () => {
    // ESTADOS DEL JUEGO
    const [currentElement, setCurrentElement] = useState(null);
    const [isPlaying, setIsPlaying] = useState(false);
    const [isPaused, setIsPaused] = useState(false);
    const [score, setScore] = useState(0);
    const [level, setLevel] = useState(1);
    const [lives, setLives] = useState(3);
    const [gameOver, setGameOver] = useState(false);
    const [fallSpeed, setFallSpeed] = useState(1000);
    const [elementPosition, setElementPosition] = useState(50);
    const [isElementFalling, setIsElementFalling] = useState(false);
    const [feedback, setFeedback] = useState('');
    const [showFeedback, setShowFeedback] = useState(false);
    const [streak, setStreak] = useState(0);
    const [bestStreak, setBestStreak] = useState(0);
    const [activeSlot, setActiveSlot] = useState(null);
    const [categoryStats, setCategoryStats] = useState({});
    const [fallTimer, setFallTimer] = useState(0);

    const gameInterval = useRef(null);
    const fallInterval = useRef(null);
    const elementRef = useRef(null);

    // SONIDOS
    const playSound = (type) => {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            if (type === 'correct') {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'incorrect') {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.linearRampToValueAtTime(200, audioContext.currentTime + 0.3);
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'levelup') {
                [0, 0.1, 0.2].forEach((time, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    const frequencies = [523.25, 659.25, 783.99];
                    oscillator.frequency.setValueAtTime(frequencies[index], audioContext.currentTime + time);
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime + time);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + time + 0.3);
                    oscillator.start(audioContext.currentTime + time);
                    oscillator.stop(audioContext.currentTime + time + 0.3);
                });
            }
        } catch (error) {
            console.log('Audio no disponible');
        }
    };

    // MÚSICA CLÁSICA DEL TETRIS (Korobeiniki)
    const playTetrisMusic = () => {
        if (!isPlaying || isPaused) return;
        
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            const playNote = (frequency, startTime, duration, volume = 0.08) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, startTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(volume, startTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(volume * 0.8, startTime + duration - 0.05);
                gainNode.gain.linearRampToValueAtTime(0, startTime + duration);
                oscillator.start(startTime);
                oscillator.stop(startTime + duration);
            };
            
            // Melodía clásica del Tetris (Korobeiniki) - Primeras frases
            const melody = [
                // Primera frase
                { freq: 659.25, duration: 0.4 }, // E
                { freq: 493.88, duration: 0.2 }, // B
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 587.33, duration: 0.4 }, // D
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 493.88, duration: 0.2 }, // B
                { freq: 440.00, duration: 0.4 }, // A
                { freq: 440.00, duration: 0.2 }, // A
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 659.25, duration: 0.4 }, // E
                { freq: 587.33, duration: 0.2 }, // D
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 493.88, duration: 0.6 }, // B
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 587.33, duration: 0.4 }, // D
                { freq: 659.25, duration: 0.4 }, // E
                { freq: 523.25, duration: 0.4 }, // C
                { freq: 440.00, duration: 0.4 }, // A
                { freq: 440.00, duration: 0.4 }, // A
                { freq: 0, duration: 0.2 }, // Pausa
                
                // Segunda frase
                { freq: 587.33, duration: 0.4 }, // D
                { freq: 698.46, duration: 0.2 }, // F
                { freq: 880.00, duration: 0.4 }, // A
                { freq: 783.99, duration: 0.2 }, // G
                { freq: 698.46, duration: 0.2 }, // F
                { freq: 659.25, duration: 0.6 }, // E
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 659.25, duration: 0.4 }, // E
                { freq: 587.33, duration: 0.2 }, // D
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 493.88, duration: 0.4 }, // B
                { freq: 493.88, duration: 0.2 }, // B
                { freq: 523.25, duration: 0.2 }, // C
                { freq: 587.33, duration: 0.4 }, // D
                { freq: 659.25, duration: 0.4 }, // E
                { freq: 523.25, duration: 0.4 }, // C
                { freq: 440.00, duration: 0.4 }, // A
                { freq: 440.00, duration: 0.4 }  // A
            ];
            
            const currentTime = audioContext.currentTime;
            let totalTime = 0;
            
            melody.forEach((note) => {
                if (note.freq > 0) {
                    playNote(note.freq, currentTime + totalTime, note.duration);
                }
                totalTime += note.duration;
            });
            
            // Repetir la música cada 20 segundos
            if (isPlaying && !isPaused) {
                setTimeout(() => {
                    if (isPlaying && !isPaused) {
                        playTetrisMusic();
                    }
                }, 20000);
            }
            
        } catch (error) {
            console.log('Música no disponible');
        }
    };
    
    // INICIAR MÚSICA CUANDO EMPIECE EL JUEGO
    useEffect(() => {
        if (isPlaying && !isPaused && !gameOver) {
            const musicDelay = setTimeout(() => {
                playTetrisMusic();
            }, 500); // Pequeño delay para que se active el audio context
            
            return () => clearTimeout(musicDelay);
        }
    }, [isPlaying, isPaused, gameOver]);

// GENERAR NUEVO ELEMENTO
    const generateNewElement = useCallback(() => {
        const randomElement = balanceElements[Math.floor(Math.random() * balanceElements.length)];
        setCurrentElement(randomElement);
        setElementPosition(Math.random() * 60 + 20); // Posición aleatoria entre 20% y 80%
        setIsElementFalling(true);
        setFallTimer(0);
    }, []);

    // INICIAR JUEGO
    const startGame = () => {
        setIsPlaying(true);
        setIsPaused(false);
        setGameOver(false);
        setScore(0);
        setLevel(1);
        setLives(3);
        setStreak(0);
        setFallSpeed(2000); // 2 segundos iniciales
        setCategoryStats({});
        generateNewElement();
    };

    // PAUSAR/REANUDAR
    const togglePause = () => {
        setIsPaused(!isPaused);
    };

    // REINICIAR
    const resetGame = () => {
        setIsPlaying(false);
        setIsPaused(false);
        setGameOver(false);
        setCurrentElement(null);
        setIsElementFalling(false);
        setShowFeedback(false);
        setFeedback('');
        setActiveSlot(null);
        clearInterval(gameInterval.current);
        clearInterval(fallInterval.current);
    };

    // MOVER ELEMENTO
    const moveElement = (direction) => {
        if (!isPlaying || isPaused || !isElementFalling) return;
        
        setElementPosition(prev => {
            if (direction === 'left') {
                return Math.max(5, prev - 15);
            } else {
                return Math.min(95, prev + 15);
            }
        });
    };

    // MANEJAR CLASIFICACIÓN
    const handleCategoryDrop = (selectedCategory) => {
        if (!isElementFalling || !currentElement || showFeedback) return;

        setActiveSlot(selectedCategory);
        setIsElementFalling(false);
        clearInterval(fallInterval.current);

        const isCorrect = selectedCategory === currentElement.category;

        if (isCorrect) {
            const pointsEarned = 10 * level;
            setScore(prev => prev + pointsEarned);
            setStreak(prev => {
                const newStreak = prev + 1;
                if (newStreak > bestStreak) {
                    setBestStreak(newStreak);
                }
                return newStreak;
            });
            
            let feedbackText = `¡Correcto! +${pointsEarned} puntos`;
            
            // Bonificación por racha
            if (streak >= 4) {
                const bonus = streak * 10;
                setScore(prev => prev + bonus);
                feedbackText += ` 🔥 ¡Racha de ${streak + 1}! +${bonus} bonus`;
            }
            
            setFeedback(feedbackText);
            playSound('correct');
            
            // Verificar subida de nivel
            if ((score + pointsEarned) > 0 && Math.floor((score + pointsEarned) / 100) > level - 1) {
                setLevel(prev => prev + 1);
                setFallSpeed(prev => Math.max(800, prev - 200));
                playSound('levelup');
                setFeedback(prev => prev + ` 🎉 ¡Nivel ${level + 1}!`);
            }
            
        } else {
            setLives(prev => prev - 1);
            setStreak(0);
            setFeedback(`Incorrecto. ${currentElement.name} va en ${categories[currentElement.category].name}`);
            playSound('incorrect');
        }

        setShowFeedback(true);
        
        // Actualizar estadísticas
        setCategoryStats(prev => ({
            ...prev,
            [selectedCategory]: {
                attempts: (prev[selectedCategory]?.attempts || 0) + 1,
                correct: (prev[selectedCategory]?.correct || 0) + (isCorrect ? 1 : 0)
            }
        }));

        setTimeout(() => {
            setShowFeedback(false);
            setActiveSlot(null);
            
            if (lives > 1 || isCorrect) {
                generateNewElement();
            } else {
                setGameOver(true);
                setIsPlaying(false);
            }
        }, 2500);
    };

    // ELEMENTO CAE AUTOMÁTICAMENTE
    const handleElementFall = () => {
        if (!isElementFalling || showFeedback) return;
        
        setLives(prev => prev - 1);
        setStreak(0);
        setIsElementFalling(false);
        setFeedback(`⏰ ¡Se escapó! ${currentElement.name} pertenece a ${categories[currentElement.category].name}`);
        setShowFeedback(true);
        playSound('incorrect');
        
        setTimeout(() => {
            setShowFeedback(false);
            if (lives > 1) {
                generateNewElement();
            } else {
                setGameOver(true);
                setIsPlaying(false);
            }
        }, 2500);
    };

// DETECTAR TECLAS
    useEffect(() => {
        const handleKeyPress = (e) => {
            if (!isPlaying || isPaused || gameOver) return;
            
            switch(e.key.toLowerCase()) {
                case 'arrowleft':
                case 'a':
                    e.preventDefault();
                    moveElement('left');
                    break;
                case 'arrowright':
                case 'd':
                    e.preventDefault();
                    moveElement('right');
                    break;
                case ' ':
                    e.preventDefault();
                    togglePause();
                    break;
                case '1':
                    e.preventDefault();
                    handleCategoryDrop('activo-corriente');
                    break;
                case '2':
                    e.preventDefault();
                    handleCategoryDrop('activo-no-corriente');
                    break;
                case '3':
                    e.preventDefault();
                    handleCategoryDrop('pasivo-corriente');
                    break;
                case '4':
                    e.preventDefault();
                    handleCategoryDrop('pasivo-no-corriente');
                    break;
                case '5':
                    e.preventDefault();
                    handleCategoryDrop('fondos-propios');
                    break;
                case 'escape':
                    e.preventDefault();
                    resetGame();
                    break;
            }
        };

        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
    }, [isPlaying, isPaused, gameOver, isElementFalling]);

    // TEMPORIZADOR DE CAÍDA
    useEffect(() => {
        if (isPlaying && !isPaused && isElementFalling && !showFeedback) {
            fallInterval.current = setInterval(() => {
                setFallTimer(prev => {
                    const newTimer = prev + 100;
                    if (newTimer >= fallSpeed) {
                        handleElementFall();
                        return 0;
                    }
                    return newTimer;
                });
            }, 100);
        } else {
            clearInterval(fallInterval.current);
        }

        return () => {
            if (fallInterval.current) {
                clearInterval(fallInterval.current);
            }
        };
    }, [isPlaying, isPaused, isElementFalling, showFeedback, fallSpeed]);

    // LIMPIAR INTERVALOS AL DESMONTAR
    useEffect(() => {
        return () => {
            if (gameInterval.current) clearInterval(gameInterval.current);
            if (fallInterval.current) clearInterval(fallInterval.current);
        };
    }, []);

    // CALCULAR PROGRESO DE CAÍDA
    const fallProgress = isElementFalling ? (fallTimer / fallSpeed) * 100 : 0;

    // OBTENER CALIFICACIÓN FINAL
    const getFinalGrade = () => {
        const accuracy = score > 0 ? (streak / (streak + (3 - lives))) * 100 : 0;
        if (score >= 500) return { grade: 'S', message: '¡Maestro del Balance!', color: 'text-yellow-400', emoji: '👑' };
        if (score >= 300) return { grade: 'A+', message: '¡Excelente conocimiento!', color: 'text-green-400', emoji: '🏆' };
        if (score >= 200) return { grade: 'A', message: '¡Muy buen trabajo!', color: 'text-green-300', emoji: '⭐' };
        if (score >= 100) return { grade: 'B', message: 'Buen desempeño', color: 'text-blue-300', emoji: '👍' };
        if (score >= 50) return { grade: 'C', message: 'Necesitas más práctica', color: 'text-yellow-300', emoji: '📚' };
        return { grade: 'D', message: 'Sigue intentando', color: 'text-red-300', emoji: '💪' };
    };

// RENDER DE LA INTERFAZ
    return (
        <div className="min-h-screen game-container p-4 text-white">
            <div className="max-w-6xl mx-auto">
                
                {/* HEADER */}
                <div className="text-center mb-6">
                    <h1 className="text-3xl md:text-4xl font-bold mb-2">
                        🧩 Tetris Balance
                    </h1>
                    <p className="text-lg opacity-90">
                        ¡Clasifica los elementos contables mientras caen!
                    </p>
                </div>

                {/* PANEL DE CONTROL */}
                <div className="bg-black bg-opacity-30 rounded-lg p-4 mb-6 backdrop-blur-sm">
                    <div className="flex justify-between items-center flex-wrap gap-4">
                        <div className="flex items-center space-x-6 flex-wrap">
                            <div className="flex items-center space-x-2">
                                <Trophy />
                                <span className="font-bold text-lg">{score}</span>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-blue-300">Nivel {level}</span>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-red-300">❤️ × {lives}</span>
                            </div>
                            {streak > 0 && (
                                <div className="flex items-center space-x-2">
                                    <Zap />
                                    <span className="text-yellow-300 font-bold pulse">Racha: {streak}</span>
                                </div>
                            )}
                            {bestStreak > 0 && (
                                <div className="flex items-center space-x-2">
                                    <span className="text-purple-300 text-sm">Mejor: {bestStreak}</span>
                                </div>
                            )}
                        </div>
                        
                        <div className="flex space-x-2">
                            {!isPlaying ? (
                                <button
                                    onClick={startGame}
                                    className="flex items-center space-x-2 px-4 py-2 bg-green-500 rounded-lg hover:bg-green-600 transition-colors font-bold"
                                >
                                    <Play />
                                    <span>JUGAR</span>
                                </button>
                            ) : (
                                <button
                                    onClick={togglePause}
                                    className="flex items-center space-x-2 px-4 py-2 bg-yellow-500 rounded-lg hover:bg-yellow-600 transition-colors font-bold"
                                >
                                    <Pause />
                                    <span>{isPaused ? 'REANUDAR' : 'PAUSA'}</span>
                                </button>
                            )}
                            
                            <button
                                onClick={resetGame}
                                className="flex items-center space-x-2 px-4 py-2 bg-gray-500 rounded-lg hover:bg-gray-600 transition-colors"
                            >
                                <RotateCcw />
                                <span>RESET</span>
                            </button>
                        </div>
                    </div>
                </div>

                {/* ÁREA DE CAÍDA DEL ELEMENTO */}
                {isPlaying && currentElement && isElementFalling && (
                    <div className="game-board p-6 mb-6">
                        <div className="relative h-40 mb-4 border-2 border-dashed border-white border-opacity-30 rounded-lg overflow-hidden">
                            
                            {/* BARRA DE PROGRESO DE CAÍDA */}
                            <div className="absolute top-0 left-0 w-full h-2 bg-black bg-opacity-30">
                                <div 
                                    className="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 transition-all duration-100"
                                    style={{ width: `${fallProgress}%` }}
                                ></div>
                            </div>
                            
                            {/* ELEMENTO CAYENDO */}
                            <div 
                                className={`absolute ${currentElement.color} text-white px-4 py-3 rounded-lg shadow-lg glow falling-element transform transition-all duration-200`}
                                style={{ 
                                    left: `${elementPosition}%`,
                                    top: `${20 + (fallProgress * 0.5)}%`,
                                    transform: 'translateX(-50%)'
                                }}
                            >
                                <div className="text-center">
                                    <div className="text-3xl mb-1">{currentElement.icon}</div>
                                    <div className="text-sm font-bold whitespace-nowrap">{currentElement.name}</div>
                                </div>
                            </div>
                            
                            {/* INDICADORES DE TIEMPO */}
                            <div className="absolute bottom-2 left-0 right-0 text-center">
                                <div className="text-white text-opacity-60 text-sm">
                                    ⏱️ {Math.ceil((fallSpeed - fallTimer) / 1000)}s restantes
                                </div>
                            </div>
                        </div>
                        
                        {/* CONTROLES VISUALES */}
                        <div className="text-center text-white text-opacity-70 text-sm mb-4">
                            <div className="flex justify-center space-x-4 flex-wrap">
                                <span>← A/Flecha: Izquierda</span>
                                <span>D/Flecha →: Derecha</span>
                                <span>1-5: Clasificar</span>
                                <span>Espacio: Pausa</span>
                            </div>
                        </div>
                    </div>
                )}

                {/* MENSAJE DE PAUSA */}
                {isPaused && (
                    <div className="text-center mb-6">
                        <div className="bg-black bg-opacity-50 rounded-lg p-6 backdrop-blur-sm">
                            <h2 className="text-2xl font-bold mb-2">⏸️ JUEGO PAUSADO</h2>
                            <p className="text-lg opacity-80">Presiona ESPACIO o el botón REANUDAR para continuar</p>
                        </div>
                    </div>
                )}

{/* FEEDBACK */}
                {showFeedback && (
                    <div className={`text-center p-4 rounded-lg mb-6 backdrop-blur-sm ${
                        feedback.includes('Correcto') || feedback.includes('¡Correcto!') 
                            ? 'bg-green-500 bg-opacity-80 border-2 border-green-300' 
                            : 'bg-red-500 bg-opacity-80 border-2 border-red-300'
                    }`}>
                        <p className="font-bold text-lg">{feedback}</p>
                        {currentElement && (
                            <div className="mt-2 text-sm opacity-90">
                                <span className="text-2xl mr-2">{currentElement.icon}</span>
                                {currentElement.name} → {categories[currentElement.category].name}
                            </div>
                        )}
                    </div>
                )}

                {/* SLOTS DE CATEGORÍAS */}
                {!gameOver && (
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                        {Object.entries(categories).map(([key, category], index) => (
                            <button
                                key={key}
                                onClick={() => handleCategoryDrop(key)}
                                disabled={!isElementFalling || showFeedback || isPaused}
                                className={`category-slot ${category.color} ${category.textColor} border-4 rounded-lg p-4 text-center cursor-pointer transition-all duration-300 min-h-[120px] flex flex-col justify-center ${
                                    activeSlot === key ? 'correct scale-105' : ''
                                } ${
                                    isElementFalling && !showFeedback && !isPaused 
                                        ? 'hover:scale-105 hover:shadow-lg transform-gpu' 
                                        : 'opacity-60'
                                }`}
                            >
                                <div className="font-bold text-2xl mb-2 bg-white bg-opacity-20 rounded-full w-8 h-8 flex items-center justify-center mx-auto">
                                    {index + 1}
                                </div>
                                <h3 className="font-bold text-sm mb-2">{category.name}</h3>
                                
                                {/* ESTADÍSTICAS DE LA CATEGORÍA */}
                                {categoryStats[key] && (
                                    <div className="text-xs opacity-75 mt-2">
                                        <div>✓ {categoryStats[key].correct}</div>
                                        <div>Total: {categoryStats[key].attempts}</div>
                                        <div>
                                            {categoryStats[key].attempts > 0 
                                                ? Math.round((categoryStats[key].correct / categoryStats[key].attempts) * 100)
                                                : 0}%
                                        </div>
                                    </div>
                                )}
                                
                                {/* INDICADOR DE TECLA */}
                                <div className="text-xs opacity-50 mt-1">
                                    Tecla: {index + 1}
                                </div>
                            </button>
                        ))}
                    </div>
                )}

                {/* ESTADÍSTICAS EN TIEMPO REAL */}
                {isPlaying && !gameOver && (
                    <div className="bg-black bg-opacity-30 rounded-lg p-4 mb-6 backdrop-blur-sm">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <div>
                                <div className="text-2xl font-bold text-green-400">{score}</div>
                                <div className="text-xs text-gray-300">Puntos</div>
                            </div>
                            <div>
                                <div className="text-2xl font-bold text-blue-400">{level}</div>
                                <div className="text-xs text-gray-300">Nivel</div>
                            </div>
                            <div>
                                <div className="text-2xl font-bold text-yellow-400">{streak}</div>
                                <div className="text-xs text-gray-300">Racha Actual</div>
                            </div>
                            <div>
                                <div className="text-2xl font-bold text-purple-400">{Math.round(fallSpeed/1000*10)/10}s</div>
                                <div className="text-xs text-gray-300">Velocidad</div>
                            </div>
                        </div>
                    </div>
                )}

                {/* PANTALLA DE GAME OVER */}
                {gameOver && (
                    <div className="bg-black bg-opacity-50 rounded-lg p-8 text-center backdrop-blur-sm mb-6">
                        <div className="text-6xl mb-4">{getFinalGrade().emoji}</div>
                        <h2 className="text-3xl font-bold mb-4">🎮 GAME OVER</h2>
                        <div className={`text-4xl font-bold mb-4 ${getFinalGrade().color}`}>
                            Calificación: {getFinalGrade().grade}
                        </div>
                        <p className="text-xl mb-6">{getFinalGrade().message}</p>
                        
                        <div className="bg-white bg-opacity-10 rounded-lg p-6 mb-6">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div>
                                    <div className="text-2xl font-bold text-green-400">{score}</div>
                                    <div className="text-sm">Puntuación Final</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-blue-400">{level}</div>
                                    <div className="text-sm">Nivel Alcanzado</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-purple-400">{bestStreak}</div>
                                    <div className="text-sm">Mejor Racha</div>
                                </div>
                                <div>
                                    <div className="text-2xl font-bold text-yellow-400">
                                        {Object.values(categoryStats).reduce((acc, stat) => acc + stat.correct, 0)}
                                    </div>
                                    <div className="text-sm">Respuestas Correctas</div>
                                </div>
                            </div>
                        </div>
                        
                        <button
                            onClick={startGame}
                            className="px-8 py-4 bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors text-xl font-bold"
                        >
                            🚀 JUGAR DE NUEVO
                        </button>
                    </div>
                )}

{/* CONTROLES DETALLADOS */}
                <div className="bg-black bg-opacity-30 rounded-lg p-4 mb-6 backdrop-blur-sm">
                    <h3 className="font-bold mb-3 text-center">🎮 CONTROLES</h3>
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-2 text-sm">
                        <div className="text-center p-2 bg-white bg-opacity-10 rounded">
                            <div className="font-bold">← A</div>
                            <div className="text-xs opacity-75">Mover Izq.</div>
                        </div>
                        <div className="text-center p-2 bg-white bg-opacity-10 rounded">
                            <div className="font-bold">D →</div>
                            <div className="text-xs opacity-75">Mover Der.</div>
                        </div>
                        <div className="text-center p-2 bg-white bg-opacity-10 rounded">
                            <div className="font-bold">1-5</div>
                            <div className="text-xs opacity-75">Clasificar</div>
                        </div>
                        <div className="text-center p-2 bg-white bg-opacity-10 rounded">
                            <div className="font-bold">ESPACIO</div>
                            <div className="text-xs opacity-75">Pausa</div>
                        </div>
                        <div className="text-center p-2 bg-white bg-opacity-10 rounded">
                            <div className="font-bold">ESC</div>
                            <div className="text-xs opacity-75">Salir</div>
                        </div>
                    </div>
                </div>

                {/* INSTRUCCIONES */}
                {!isPlaying && !gameOver && (
                    <div className="bg-black bg-opacity-30 rounded-lg p-6 backdrop-blur-sm mb-6">
                        <h3 className="text-xl font-bold mb-4 text-center">📚 CÓMO JUGAR</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 className="font-bold mb-2 text-green-300">🎯 Objetivo:</h4>
                                <ul className="text-sm space-y-1 list-disc list-inside">
                                    <li>Los elementos contables caen desde arriba</li>
                                    <li>Clasifícalos en la categoría correcta</li>
                                    <li>¡Consigue la mayor puntuación posible!</li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-bold mb-2 text-blue-300">⚡ Mecánicas:</h4>
                                <ul className="text-sm space-y-1 list-disc list-inside">
                                    <li>Tienes 3 vidas al comenzar</li>
                                    <li>Cada nivel aumenta la velocidad</li>
                                    <li>Las rachas te dan puntos bonus</li>
                                    <li>¡La música clásica del Tetris te acompaña!</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div className="mt-4 p-4 bg-white bg-opacity-10 rounded-lg">
                            <h4 className="font-bold mb-2 text-yellow-300">🏆 Sistema de Puntuación:</h4>
                            <div className="text-sm grid md:grid-cols-3 gap-2">
                                <div>• Respuesta correcta: 10 × Nivel</div>
                                <div>• Racha de 5+: +50 puntos bonus</div>
                                <div>• Cada 100 puntos = Nuevo nivel</div>
                            </div>
                        </div>
                    </div>
                )}

                {/* CATEGORÍAS DE REFERENCIA */}
                {!isPlaying && !gameOver && (
                    <div className="bg-black bg-opacity-30 rounded-lg p-6 backdrop-blur-sm mb-6">
                        <h3 className="text-xl font-bold mb-4 text-center">📊 CATEGORÍAS DEL BALANCE</h3>
                        <div className="grid md:grid-cols-5 gap-4 text-xs">
                            {Object.entries(categories).map(([key, category], index) => (
                                <div key={key} className={`${category.color} ${category.textColor} p-3 rounded-lg`}>
                                    <div className="font-bold mb-1">{index + 1}. {category.name}</div>
                                    <div className="text-xs opacity-75">
                                        {key === 'activo-corriente' && 'Bienes que se convierten en dinero en menos de 1 año'}
                                        {key === 'activo-no-corriente' && 'Bienes permanentes (más de 1 año)'}
                                        {key === 'pasivo-corriente' && 'Deudas a pagar en menos de 1 año'}
                                        {key === 'pasivo-no-corriente' && 'Deudas a largo plazo (más de 1 año)'}
                                        {key === 'fondos-propios' && 'Recursos propios de la empresa'}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* FOOTER */}
                <div className="text-center text-white text-opacity-60 text-sm">
                    <p className="mb-2">
                        🎓 <strong>Tetris Balance</strong> - Herramienta educativa para Bachillerato
                    </p>
                    <p>
                        🎵 Con la música clásica del Tetris • 📱 Compatible móvil y PC • 🆓 Totalmente gratuito
                    </p>
                </div>
            </div>
        </div>
    );
};

// RENDERIZAR APLICACIÓN
const root = window.ReactDOM.createRoot(document.getElementById('root'));
root.render(<TetrisBalanceGame />);
    </script>
</body>
</html>